mutate(coeff = country)
coefficients <- rbind(coefficients, coeff)
}
for (country in countries){
country_data <- data %>%
filter(Country == country)
print(country)
fit <- lm(stock_change ~ stringency_index +
stringency_index_m1 +
stringency_index_m2 +
stringency_index_m3 +
stringency_index_m4 +
stringency_index_m5 +
stringency_index_m6 +
stringency_index_m7 +
stringency_index_m8 +
stringency_index_m9 +
stringency_index_m10 +
covid_rate +
median_age +
life_expectancy +
frac_DPI +
aged_65_older +
covid_rate +
human_development_index +
population_density +
gdp_per_capita +
stimulus_spending_pct_gdp +
liquidity_support_pct_gdp +
health_stimulus_spending_pct_gdp +
CCI +
oil_price, data=country_data)
#   CCI +
coeff <- tidy(fit) %>%
select(term, estimate) %>%
spread(term, estimate) %>%
mutate(coeff = country)
coefficients <- rbind(coefficients, coeff)
}
for (country in countries){
country_data <- data %>%
filter(Country == country)
print(country)
fit <- lm(stock_change ~ stringency_index +
stringency_index_m1 +
stringency_index_m2 +
stringency_index_m3 +
stringency_index_m4 +
stringency_index_m5 +
stringency_index_m6 +
stringency_index_m7 +
stringency_index_m8 +
stringency_index_m9 +
stringency_index_m10 +
covid_rate +
median_age +
life_expectancy +
frac_DPI +
aged_65_older +
covid_rate +
human_development_index +
population_density +
gdp_per_capita +
stimulus_spending_pct_gdp +
liquidity_support_pct_gdp +
health_stimulus_spending_pct_gdp +
oil_price, data=country_data)
coeff <- tidy(fit) %>%
select(term, estimate) %>%
spread(term, estimate) %>%
mutate(coeff = country)
coefficients <- rbind(coefficients, coeff)
}
View(coefficients)
library(tidyverse)
library(car)
library(xtable)
library(stargazer)
library(broom)
library(ggplot2)
library(dplyr)
require(maps)
require(maps)
require(viridis)
theme_set(theme_void())
library(maps)
library(viridis)
install.packages("maps")
library(maps)
library(viridis)
theme_set(theme_void())
world_map <- map_data("world")
ggplot(world_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white")
coefficients <- coefficients %>%
dplyr::rename(region = country)
countries <- unique(data$Country)
countries <- countries[!(countries %in% c("HKG"))]
coefficients <- data.frame()
for (country in countries){
country_data <- data %>%
filter(Country == country)
fit <- lm(stock_change ~ stringency_index +
stringency_index_m1 +
stringency_index_m2 +
stringency_index_m3 +
stringency_index_m4 +
stringency_index_m5 +
stringency_index_m6 +
stringency_index_m7 +
stringency_index_m8 +
stringency_index_m9 +
stringency_index_m10 +
covid_rate +
median_age +
life_expectancy +
frac_DPI +
aged_65_older +
covid_rate +
human_development_index +
population_density +
gdp_per_capita +
stimulus_spending_pct_gdp +
liquidity_support_pct_gdp +
health_stimulus_spending_pct_gdp +
oil_price, data=country_data)
coeff <- tidy(fit) %>%
select(term, estimate) %>%
spread(term, estimate) %>%
mutate(Country = country)
coefficients <- rbind(coefficients, coeff)
}
coefficients <- coefficients %>%
dplyr::rename(region = country)
countries <- unique(data$Country)
countries <- countries[!(countries %in% c("HKG"))]
coefficients <- data.frame()
for (country in countries){
country_data <- data %>%
filter(Country == country)
fit <- lm(stock_change ~ stringency_index +
stringency_index_m1 +
stringency_index_m2 +
stringency_index_m3 +
stringency_index_m4 +
stringency_index_m5 +
stringency_index_m6 +
stringency_index_m7 +
stringency_index_m8 +
stringency_index_m9 +
stringency_index_m10 +
covid_rate +
median_age +
life_expectancy +
frac_DPI +
aged_65_older +
covid_rate +
human_development_index +
population_density +
gdp_per_capita +
stimulus_spending_pct_gdp +
liquidity_support_pct_gdp +
health_stimulus_spending_pct_gdp +
oil_price, data=country_data)
coeff <- tidy(fit) %>%
select(term, estimate) %>%
spread(term, estimate) %>%
mutate(region = country)
coefficients <- rbind(coefficients, coeff)
}
world_map <- map_data("world")
coeff_map <- left_join(coefficients, world_map, by = "region")
View(coeff_map)
View(world_map)
library(countrycode)
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') )
coeff_map <- left_join(coefficients, world_map, by = "region")
ggplot(world_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white")
View(coeff_map)
ggplot(world_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill=stringency_index, colour = "white")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill=stringency_index, colour = "white")
coeff_map <- left_join(coefficients, world_map, by = "region")
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') )
coeff_map <- left_join(coefficients, world_map, by = "region")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill=stringency_index, colour = "white")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill=stringincy_index, colour = "white")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index), colour = "white")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C")
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') )
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C")
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') )
coeff_map <- left_join(coefficients, world_map, by = "region")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=if_else(is.na(stringency_index),"lightgray", stringency_index)), colour = "white") +
scale_fill_viridis_c(option = "C")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white") +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white") +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') )
coeff_map <- left_join(world_map,coefficients by = "region")
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') )
coeff_map <- left_join(world_map,coefficients, by = "region")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white") +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
View(world_map)
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') ) %>%
filter(region != "ATA")
coeff_map <- left_join(world_map,coefficients, by = "region")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white") +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
coeff_list <- colnames(coefficients)
coeff_list <- coeff_list[!(coeff_list %in% c("(Intercept)", "region"))]
for (coeff in coeff_list){
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white") +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave(paste("./plots/",coeff,"_map",sep=""))
}
for (coeff in coeff_list){
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white") +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave(paste("./plots/",coeff,"_map",sep=""), device = "pdf")
}
for (coeff in coeff_list){
print(coeff)
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(fill="lightgray", colour = "white") +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave(paste("./plots/",coeff,"_map",sep=""), device = "pdf")
}
for (coeff in coeff_list){
print(coeff)
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave(paste("./plots/",coeff,"_map",sep=""), device = "pdf")
}
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
for (coeff in coeff_list){
print(coeff)
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map",sep="")
print(filename)
ggsave(filename, device = "pdf")
}
for (coeff in coeff_list){
print(coeff)
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map.pdf",sep="")
print(filename)
ggsave(filename)
}
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/covid_rate_map.pdf")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/covid_rate_map.pdf")
for (coeff in coeff_list){
print(coeff)
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map.pdf",sep="")
print(filename)
ggsave(filename)
}
for (coeff in coeff_list){
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map.pdf",sep="")
pdf(filename)
}
for (coeff in coeff_list){
plot <- ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map.pdf",sep="")
pdf(filename)
print(plot)
dev.off()
}
for (coeff in coeff_list){
print(coeff)
plot <- ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map.pdf",sep="")
pdf(filename)
print(plot)
dev.off()
}
coeff_list <- coeff_list[!(coeff_list %in% c("(Intercept)", "region", "covid_rate"))]
for (coeff in coeff_list){
print(coeff)
plot <- ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map.pdf",sep="")
pdf(filename)
print(plot)
dev.off()
}
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') ) %>%
filter(region != "ATA")
coeff_map <- left_join(world_map,coefficients, by = "region")
coeff_list <- colnames(coefficients)
coeff_list <- coeff_list[!(coeff_list %in% c("(Intercept)", "region"))]
plots <- list()
for (coeff in coeff_list){
print(coeff)
plot <- ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
plots <- list(plots, plot)
}
for(plot in plots){
ggsave("myplot.png", plot = plot)
}
for (coeff in coeff_list){
print(coeff)
plot <- ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=coeff), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
filename <- paste("./plots/",coeff,"_map.pdf", sep="")
ggsave(filename, plot = plot)
}
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') ) %>%
filter(region != "ATA")
coeff_map <- left_join(world_map,coefficients, by = "region")
coeff_list <- colnames(coefficients)
coeff_list <- coeff_list[!(coeff_list %in% c("(Intercept)", "region"))]
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/covid_rate_map.pdf")
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/covid_rate_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/covid_rate_map.pdf", scale = 1)
ggsave("./plots/covid_rate_map.pdf", width=11, height=8.5, units="in")
world_map <- map_data("world") %>%
mutate(region = countrycode(region, origin = 'country.name', destination = 'iso3c') )
coeff_map <- left_join(world_map,coefficients, by = "region")
coeff_list <- colnames(coefficients)
coeff_list <- coeff_list[!(coeff_list %in% c("(Intercept)", "region"))]
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/covid_rate_map.pdf", width=11, height=8.5, units="in")
source('~/Documents/Joe 2020-2021/21W/QSS Project/QSS82-Team9/scripts/Geo_plots.R', echo=TRUE)
# stringency_index
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/stringency_index_map.pdf", width=11, height=8.5, units="in")
# stringency_index_m1
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index_m1), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/stringency_index_m1_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/stringency_index_m1_map.pdf", width=11, height=8.5, units="in")
source('~/Documents/Joe 2020-2021/21W/QSS Project/QSS82-Team9/scripts/Geo_plots.R', echo=TRUE)
install.packages("gifski")
library(gifski)
plot_files <- list.files("./plots/", pattern = "stringency_index.*png$", full.names = TRUE)
plot_files <- list.files("./plots/", pattern = "stringency_index", full.names = TRUE)
plot_files <- list.files("./plots", pattern = "stringency_index", full.names = TRUE)
plot_files <- sort(plot_files)
plot_files <- list.files("./plots", pattern = "stringency_index", full.names = TRUE)
plot_files <- sort(plot_files)
plot_files
plot_files <- c(unlist(plot_files))
plot_files
plot_files <- sort(plot_files)
typeof(plot_files)
plot_files <- sort(plot_files)
gifski(plot_files, gif_file = "animation.gif", width = 800, height = 600, delay = 1)
source('~/Documents/Joe 2020-2021/21W/QSS Project/QSS82-Team9/scripts/Geo_plots.R', echo=TRUE)
plot_files <- list.files("./plots", pattern = "stringency_index*.png", full.names = TRUE)
plot_files <- list.files("./plots", pattern = "stringency_index.*png", full.names = TRUE)
plot_files <- c(unlist(plot_files))
plot_files <- sort(plot_files)
typeof(plot_files)
gifski(plot_files, gif_file = "animation.gif", width = 800, height = 600, delay = 1)
gifski(plot_files, gif_file = "./plots/animation.gif", width = 800, height = 600, delay = 1)
plot_files
plot_files <- c("./plots/stringency_index_map.png",
"./plots/stringency_index_m1_map.png",
"./plots/stringency_index_m2_map.png",
"./plots/stringency_index_m3_map.png",
"./plots/stringency_index_m4_map.png",
"./plots/stringency_index_m5_map.png",
"./plots/stringency_index_m6_map.png",
"./plots/stringency_index_m7_map.png",
"./plots/stringency_index_m8_map.png",
"./plots/stringency_index_m9_map.png",
"./plots/stringency_index_m10_map.png"
)
gifski(plot_files, gif_file = "./plots/animation.gif", width = 800, height = 600, delay = 1)
colMax <- function(data) sapply(data, max, na.rm = TRUE)
max <- colMax(coefficients)
max_coeff <- max(max)
max
colMax <- function(data[coeff_list]) sapply(data, max, na.rm = TRUE)
max <- colMax(coefficients[coeff_list])
max
max_coeff <- max(max)
colMax <- function(data) sapply(data, max, na.rm = TRUE)
max <- colMax(coefficients[coeff_list])
max_coeff <- max(max)
colMin <- function(data) sapply(data, min, na.rm = TRUE)
min <- colMin(coefficients[coeff_list])
min_coeff <- min(min)
# covid_rate
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/covid_rate_map.pdf", width=11, height=8.5, units="in", limits = range(min_coeff, max_coeff))
ggsave("./plots/covid_rate_map.png", width=11, height=8.5, units="in", limits = range(min_coeff, max_coeff))
# oil_price
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=oil_price), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/oil_price_map.pdf", width=11, height=8.5, units="in", limits = range(min_coeff, max_coeff))
ggsave("./plots/oil_price_map.png", width=11, height=8.5, units="in", limits = range(min_coeff, max_coeff))
# covid_rate
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray", limits = range(min_coeff, max_coeff))
ggsave("./plots/covid_rate_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/covid_rate_map.png", width=11, height=8.5, units="in")
# oil_price
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=oil_price), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray",limits = range(min_coeff, max_coeff))
ggsave("./plots/oil_price_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/oil_price_map.png", width=11, height=8.5, units="in")
# covid_rate
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=covid_rate), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/covid_rate_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/covid_rate_map.png", width=11, height=8.5, units="in")
# oil_price
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=oil_price), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray")
ggsave("./plots/oil_price_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/oil_price_map.png", width=11, height=8.5, units="in")
# stringency_index
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray", limits = range(min_coeff, max_coeff))
ggsave("./plots/stringency_index_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/stringency_index_map.png", width=11, height=8.5, units="in")
# stringency_index_m1
ggplot(coeff_map, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill=stringency_index_m1), colour = "white") +
scale_fill_viridis_c(option = "C", na.value = "lightgray", limits = range(min_coeff, max_coeff))
ggsave("./plots/stringency_index_m1_map.pdf", width=11, height=8.5, units="in")
ggsave("./plots/stringency_index_m1_map.png", width=11, height=8.5, units="in")
source('~/Documents/Joe 2020-2021/21W/QSS Project/QSS82-Team9/scripts/Geo_plots.R', echo=TRUE)
source('~/Documents/Joe 2020-2021/21W/QSS Project/QSS82-Team9/scripts/Geo_plots.R', echo=TRUE)
